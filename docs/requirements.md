# Chrome拡張機能 要件定義書
## Webページリマインダー

**作成日**: 2025年10月31日  
**バージョン**: 1.0

---

## 1. 概要

特定のWebページにアクセスした際に、事前に登録したリマインダー（やるべきこと）を表示するChrome拡張機能。

---

## 2. 主要機能

### 2.1 URL照合ルール
- **マッチング方式**: 前方一致
  - 登録URL: `https://example.com/shop`
  - マッチするURL: `https://example.com/shop`、`https://example.com/shop/products`、`https://example.com/shop/cart` など
- **同一URLへの複数登録**: 可能

### 2.2 リマインダー表示
- **表示タイミング**: ページ読み込み完了時
- **表示方法**: Webページ上にオーバーレイ形式のポップアップ
- **複数リマインダーの表示**: 1つのポップアップ内に全てリスト表示

#### 表示UI
- 画面右上または中央に固定表示
- 半透明の背景オーバーレイ
- リマインダーをリスト形式で表示
- 各リマインダーに個別の「完了」ボタン
- 「すべて閉じる」ボタン
- スクロール可能（リマインダーが多い場合）

#### UIイメージ
```
━━━━━━━━━━━━━━━━━━━━━━━━━
   このページでやること
━━━━━━━━━━━━━━━━━━━━━━━━━
□ クーポンコードを入力すること
                    [✓ 完了]

□ 送料無料の条件を確認
                    [✓ 完了]

□ ポイント利用を検討
                    [✓ 完了]

━━━━━━━━━━━━━━━━━━━━━━━━━
        [すべて閉じる]
━━━━━━━━━━━━━━━━━━━━━━━━━
```

#### 操作オプション
- **A. 個別削除（完了）**:
  - 特定のリマインダーの「完了」ボタンをクリック
  - そのリマインダーをストレージから削除
  - リストから即座に消える
  - 他のリマインダーは残る
  - すべて削除したらポップアップも自動で閉じる

- **B. すべて閉じる**:
  - 「すべて閉じる」ボタンをクリック
  - ポップアップのみ非表示
  - リマインダーは削除せずストレージに残る
  - 次回ページ読み込み時に再度表示される

#### 再表示の挙動
- ページ更新（F5キーやリロード）→ リマインダー再表示
- 別ページに移動後、同じURLに戻る → リマインダー再表示
- ブラウザを閉じて再度アクセス → リマインダー再表示
- リマインダーは「完了」で削除されるまで何度でも表示される

### 2.3 リマインダー登録機能

#### 登録項目
- **URL**（必須）: 前方一致で照合される
- **リマインダーテキスト**（必須）

#### 登録画面
拡張機能のポップアップから登録
- 現在表示中のページURLを自動入力
- URLは手動編集可能
- リマインダーテキスト入力欄（テキストエリア）
- 「登録」ボタン

### 2.4 リマインダー管理機能

#### 一覧表示
- URL別にグループ化して表示
- 各リマインダーのテキストも表示

#### 削除機能
- 各リマインダーに削除ボタン
- ポップアップ内での「完了」とは別に、管理画面からも削除可能

#### 表示場所
拡張機能のポップアップ画面内

---

## 3. データ保存

### 3.1 保存先
- `chrome.storage.local`

### 3.2 データ構造
```javascript
{
  reminders: [
    {
      id: "uuid_1",
      url: "https://example.com/shop",
      text: "クーポンコードを入力すること",
      createdAt: "2025-10-31T10:00:00Z"
    },
    {
      id: "uuid_2",
      url: "https://example.com/shop",
      text: "送料無料の条件を確認",
      createdAt: "2025-10-31T10:05:00Z"
    },
    {
      id: "uuid_3",
      url: "https://example.com/account",
      text: "パスワード変更する",
      createdAt: "2025-10-31T11:00:00Z"
    }
  ]
}
```

---

## 4. ファイル構成
```
extension/
├── manifest.json          # 拡張機能の設定
├── popup.html            # 登録・管理画面のHTML
├── popup.js              # 登録・管理画面のロジック
├── popup.css             # 登録・管理画面のスタイル
├── content.js            # Webページへのリマインダー表示
├── content.css           # リマインダーポップアップのスタイル
└── icons/                # 拡張機能のアイコン
    ├── icon16.png
    ├── icon48.png
    └── icon128.png
```

---

## 5. 機能フロー

### 5.1 登録フロー
1. ユーザーがリマインダーを設定したいページを開く
2. 拡張機能アイコンをクリック
3. 現在のページURLが自動入力される
4. リマインダー内容を入力
5. 「登録」ボタンをクリック
6. `chrome.storage.local`に保存
7. 「登録しました」メッセージ表示

### 5.2 表示・操作フロー
1. ユーザーがWebページにアクセス
2. `content.js`がページ読み込み完了を検知
3. 現在のURLを`chrome.storage.local`と照合
4. 前方一致するURLのリマインダーを全て取得
5. 該当がある場合、ポップアップを生成して表示
   - 複数ある場合は全てリスト表示
   - 各リマインダーに「完了」ボタン
   - 「すべて閉じる」ボタン
6. ユーザーの操作:
   - **パターンA: タスク完了**
     - 「完了」ボタンをクリック
     - 該当リマインダーをストレージから削除
     - リストから削除されたリマインダーが消える
     - 残りのリマインダーがあれば表示継続
     - すべて完了したらポップアップ自動で閉じる
   - **パターンB: 後でやる**
     - 「すべて閉じる」ボタンをクリック
     - ポップアップのみ非表示
     - リマインダーはストレージに保持
     - ページ更新時や次回アクセス時に再表示

### 5.3 管理フロー
1. 拡張機能アイコンをクリック
2. 登録済みリマインダー一覧を表示（URL別にグループ化）
3. 削除したいリマインダーの削除ボタンをクリック
4. `chrome.storage.local`から削除
5. 一覧を更新

---

## 6. エッジケース・考慮事項

### 6.1 入力バリデーション
- URLが空の場合: 登録ボタンを無効化
- テキストが空の場合: 登録ボタンを無効化
- 同じURL・同じテキストの重複登録: 許可する（意図的に複数回登録したい場合もある）

### 6.2 表示関連
- リマインダーが0件の場合: 「リマインダーが登録されていません」と表示
- ポップアップの表示位置: 既存のページコンテンツに被らないよう、z-indexを高く設定
- リマインダーが非常に多い場合: ポップアップ内でスクロール可能にする

### 6.3 削除・完了関連
- 一部のリマインダーを完了した場合:
  - 完了したものだけ削除
  - 残りは引き続き表示
  - ポップアップは開いたまま
- すべてのリマインダーを完了した場合:
  - ポップアップを自動的に閉じる
  - 次回アクセス時は該当リマインダーがないので表示されない
- 「すべて閉じる」後に個別削除したい場合:
  - 拡張機能の管理画面から削除可能
  - またはページを再読み込みしてポップアップから削除

---

## 7. 技術要件

### 7.1 必須API
- Chrome Extensions Manifest V3
- `chrome.storage.local`
- Content Scripts
- Browser Action (拡張機能アイコン)

### 7.2 イベント
- ページ読み込み完了検知（`DOMContentLoaded` or `load`イベント）
- クリックイベント（ボタン操作）
- ストレージ更新イベント

---

## 8. 将来の拡張可能性（現バージョンでは未実装）

- カテゴリやタグでリマインダーを分類
- リマインダーの優先度設定
- 表示回数の制限（1回のみ、○回まで等）
- エクスポート/インポート機能
- スヌーズ機能（「後で通知」ボタン）
- 完全一致、ドメイン一致、正規表現などの照合オプション
- 複数デバイス間での同期（`chrome.storage.sync`）

---

## 9. 補足

本要件定義書は、シンプルで実用的なリマインダー機能の実装を目的としています。基本機能の動作確認後、必要に応じて追加機能を検討することが推奨されます。